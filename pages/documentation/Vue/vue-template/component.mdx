## 5. 组件库按需导入

### 5.1 按需导入

需要两个插件

> pnpm install -D unplugin-vue-components unplugin-auto-import

vite.config.js

```js
// 自动导入
import AutoImport from 'unplugin-auto-import/vite'
import Components from 'unplugin-vue-components/vite'
import { ElementPlusResolver } from 'unplugin-vue-components/resolvers'

import ElementPlus from 'unplugin-element-plus/vite'

// https://vitejs.dev/config/
export default defineConfig({
  ...
  plugins: [
    ...
    // 自动导入
    AutoImport({
      imports: ['vue', 'vue-router'], // 顺便自动导入 vue vue-router
      resolvers: [ElementPlusResolver()],
      eslintrc: { enabled: false },
      dts: 'src/auto-import.d.ts' // 生成的全局变量放到此目录下
    }),
    Components({
      // 默认只针对src/components目录实现自动导入
      dirs: ['src/components', 'src/layout/components'], // 后面布局组件也有相关的组件期望自动导入
      dts: 'src/components.d.ts',
      resolvers: [ElementPlusResolver()] // 生成的组件的类型放到这里
    }),
  ]
})
```

### 5.2 弹框类型的组件挂载到 app 上

src/plugins/element.ts

```ts
import { App } from "vue";
import { ElMessage, ElNotification, ElMessageBox } from "element-plus";
// 默认自动导入组件插件，只会解析在模板中使用的组件，所以这里需要导入样式
// 这里的样式也可以做到按需导入
import "element-plus/theme-chalk/el-message.css";
import "element-plus/theme-chalk/el-notification.css";
import "element-plus/theme-chalk/el-message-box.css";
export default (app: App): void => {
  // 按需导入组件列表
  // Vue.prototype 替换为 config.globalProperties
  // 文档说明 https://v3.cn.vuejs.org/guide/migration/global-api.html#vueprototype-%E6%9B%BF%E6%8D%A2%E4%B8%BA-config-globalproperties
  app.config.globalProperties.$message = ElMessage;
  app.config.globalProperties.$notify = ElNotification;
  app.config.globalProperties.$confirm = ElMessageBox.confirm;
  app.config.globalProperties.$alert = ElMessageBox.alert;
  app.config.globalProperties.$prompt = ElMessageBox.prompt;
};
```

src/main.ts

```ts
...
// 注册element-plus
import installElementPlus from './plugins/element'

...
app.use(installElementPlus)

```

### 5.3 按需导入样式

vite.config.js

```js
import ElementPlus from 'unplugin-element-plus/vite'

export default defineConfig({
  ...
  plugins: [
    ...
    ElementPlus({})
  ]
})

```

注释掉 src/plugins/element.ts

```ts
import { App } from "vue";
import { ElMessage, ElNotification, ElMessageBox } from "element-plus";
// 默认自动导入组件插件，只会解析在模板中使用的组件，所以这里需要导入样式
// 这里的样式也可以做到按需导入
// import 'element-plus/theme-chalk/el-message.css'
// import 'element-plus/theme-chalk/el-notification.css'
// import 'element-plus/theme-chalk/el-message-box.css'
```

### 5.4 组件中使用

```vue
<template>
  <div>
    <h1>Dashboard page</h1>
    <svg-icon icon-class="bug"></svg-icon>
    <!-- icon-class svg图标名称 class-name 额外的自定义类名 @click绑定事件 -->
    <svg-icon
      icon-class="404"
      class-name="custom-class"
      @click="sayHi"
    ></svg-icon>
  </div>
</template>
<script setup lang="ts">
// import { getCurrentInstance } from 'vue'
const { proxy } = getCurrentInstance()!;
const sayHi = () => {
  proxy?.$message.success("恭喜你，这是一条成功消息");
};
</script>
<style lang="scss">
.custom-class {
  // 自定义样式404
  font-size: 200px;
  color: green;
}
</style>
```

### 5.5 解决 eslint 报错问题

getCurrentInstance 不存在

vite.config.js

```js
 AutoImport({
    imports: ['vue', 'vue-router'], // 顺便自动导入 vue vue-router
    resolvers: [ElementPlusResolver()],
    eslintrc: { enabled: false }, // 改成true生成一次后禁用即可
    dts: 'src/auto-import.d.ts' // 生成的全局变量放到此目录下
  }),
```

.eslintrc.cjs

```cjs
module.exports = {
  ...
  extends: [
    // 推荐的规则直接拿来用
    ...
    './.eslintrc-auto-import.json'
  ],
  ...
  rules: {
    // 自定义的规则
    ...
    '@typescript-eslint/no-non-null-assertion': 'off'
  }
}
```